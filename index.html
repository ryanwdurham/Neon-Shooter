<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Fake Store API ‚Äî QA Checkout Tester</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

* {
  box-sizing: border-box;
}

body { 
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
  min-height: 100vh;
  color: #e2e8f0;
}

header { 
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
  color: white;
  padding: 32px 24px;
  box-shadow: 0 4px 24px rgba(99, 102, 241, 0.3);
  position: relative;
  overflow: hidden;
}

header::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation: pulse 8s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 0.5; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

header h1 { 
  margin: 0;
  font-size: 32px;
  font-weight: 700;
  letter-spacing: -0.5px;
  text-shadow: 0 2px 12px rgba(0,0,0,0.2);
  position: relative;
  z-index: 1;
}

header p { 
  margin: 8px 0 0;
  opacity: 0.95;
  font-size: 15px;
  font-weight: 500;
  position: relative;
  z-index: 1;
}

main { 
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
  padding: 24px;
  max-width: 1600px;
  margin: 0 auto;
}

.panel { 
  background: rgba(30, 41, 59, 0.8);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(100, 116, 139, 0.2);
  transition: all 0.3s ease;
}

.panel:hover {
  box-shadow: 0 12px 48px rgba(99, 102, 241, 0.2);
  border-color: rgba(139, 92, 246, 0.3);
}

h2 { 
  margin-top: 0;
  font-size: 20px;
  font-weight: 700;
  background: linear-gradient(135deg, #a78bfa 0%, #ec4899 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  padding-bottom: 12px;
  border-bottom: 2px solid rgba(139, 92, 246, 0.3);
  letter-spacing: -0.3px;
}

button { 
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  font-family: 'Inter', sans-serif;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  position: relative;
  overflow: hidden;
}

button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

button:hover::before {
  width: 300px;
  height: 300px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
}

button:active {
  transform: translateY(0);
}

button.danger { 
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

button.danger:hover {
  box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
}

button.secondary { 
  background: linear-gradient(135deg, #475569 0%, #334155 100%);
  box-shadow: 0 4px 12px rgba(71, 85, 105, 0.3);
}

button.secondary:hover {
  box-shadow: 0 6px 20px rgba(71, 85, 105, 0.5);
}

.products { 
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 16px;
  margin-top: 16px;
}

.product { 
  border: 1px solid rgba(100, 116, 139, 0.3);
  border-radius: 12px;
  padding: 16px;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(8px);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.product::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #6366f1, #8b5cf6, #d946ef);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.product:hover::before {
  transform: scaleX(1);
}

.product:hover {
  box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
  transform: translateY(-4px);
  border-color: rgba(139, 92, 246, 0.5);
}

.product img { 
  height: 140px;
  object-fit: contain;
  display: block;
  margin: auto;
  border-radius: 8px;
  padding: 8px;
}

.product b {
  font-size: 14px;
  color: #f1f5f9;
  display: block;
  margin: 12px 0 8px;
  line-height: 1.4;
}

.price { 
  color: #10b981;
  font-weight: 700;
  font-size: 18px;
  text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
}

.cart-item { 
  font-size: 13px;
  margin-bottom: 16px;
  padding: 12px;
  background: rgba(15, 23, 42, 0.5);
  border-radius: 8px;
  border: 1px solid rgba(100, 116, 139, 0.2);
  transition: all 0.2s ease;
}

.cart-item:hover {
  background: rgba(15, 23, 42, 0.7);
  border-color: rgba(139, 92, 246, 0.3);
}

.cart-item b {
  color: #a78bfa;
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
}

.api-console { 
  background: #0a0e1a;
  color: #94a3b8;
  padding: 16px;
  border-radius: 12px;
  font-family: 'JetBrains Mono', Consolas, monospace;
  font-size: 12px;
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid rgba(100, 116, 139, 0.3);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
}

.api-console::-webkit-scrollbar {
  width: 8px;
}

.api-console::-webkit-scrollbar-track {
  background: rgba(15, 23, 42, 0.5);
  border-radius: 4px;
}

.api-console::-webkit-scrollbar-thumb {
  background: rgba(139, 92, 246, 0.5);
  border-radius: 4px;
}

.api-console::-webkit-scrollbar-thumb:hover {
  background: rgba(139, 92, 246, 0.7);
}

.api-console pre {
  margin: 8px 0;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.pass { 
  color: #10b981;
  font-weight: 600;
  text-shadow: 0 0 8px rgba(16, 185, 129, 0.3);
}

.fail { 
  color: #ef4444;
  font-weight: 600;
  text-shadow: 0 0 8px rgba(239, 68, 68, 0.3);
}

footer { 
  padding: 24px;
  font-size: 13px;
  text-align: center;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(10px);
  color: #94a3b8;
  font-style: italic;
  border-top: 1px solid rgba(100, 116, 139, 0.2);
}

label {
  font-size: 13px;
  color: #cbd5e1;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  margin-left: 12px;
  padding: 4px 8px;
  border-radius: 6px;
  transition: all 0.2s ease;
}

label:hover {
  background: rgba(139, 92, 246, 0.1);
}

input[type="checkbox"] {
  cursor: pointer;
  width: 16px;
  height: 16px;
  accent-color: #8b5cf6;
}

.button-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 16px;
  align-items: center;
}

hr {
  border: none;
  border-top: 1px solid rgba(139, 92, 246, 0.3);
  margin: 16px 0;
}

#cart {
  min-height: 60px;
}

.empty-cart {
  color: #64748b;
  font-style: italic;
  text-align: center;
  padding: 24px;
  font-size: 14px;
}

.product button {
  margin-top: 8px;
  margin-right: 4px;
  font-size: 12px;
  padding: 6px 12px;
}

.console-wrapper {
  margin: 0 24px 24px;
}

/* Toast Notifications */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toast {
  background: rgba(30, 41, 59, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 12px;
  padding: 16px 20px;
  min-width: 300px;
  max-width: 400px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  border: 1px solid rgba(100, 116, 139, 0.3);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideIn 0.3s ease;
  position: relative;
  overflow: hidden;
}

.toast::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: #6366f1;
}

.toast.success::before {
  background: #10b981;
}

.toast.error::before {
  background: #ef4444;
}

.toast.warning::before {
  background: #f59e0b;
}

.toast-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.toast-content {
  flex: 1;
  color: #e2e8f0;
}

.toast-title {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 4px;
}

.toast-message {
  font-size: 13px;
  opacity: 0.9;
}

.toast-close {
  background: none;
  border: none;
  color: #94a3b8;
  cursor: pointer;
  font-size: 20px;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: all 0.2s;
  flex-shrink: 0;
}

.toast-close:hover {
  background: rgba(100, 116, 139, 0.2);
  color: #fff;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

.toast.removing {
  animation: slideOut 0.3s ease forwards;
}

@media (max-width: 1024px) {
  main {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
<div class="toast-container" id="toastContainer"></div>

<header>
  <h1>üõí Fake Store API ‚Äî QA Checkout Tester üíª</h1>
  <p>API-first demo ‚Ä¢ Auth ‚Ä¢ Assertions ‚Ä¢ Failure handling</p>
</header>

<main>

<div class="panel">
  <h2>Products</h2>
  <div class="button-group">
    <button onclick="login()">üîê Login</button>
    <button onclick="loadProducts()">üì¶ Load Products</button>
    <label>
      <input type="checkbox" id="failToggle" /> Simulate API Failure
    </label>
  </div>
  <div class="products" id="products"></div>
</div>

<div class="panel">
  <h2>Shopping Cart</h2>
  <div id="cart" class="empty-cart">Cart is empty</div>
  <div class="button-group" style="margin-top: 16px;">
    <button class="secondary" onclick="syncCart()">üîÑ Sync Cart (PUT)</button>
    <button class="danger" onclick="checkout()">üí≥ Checkout</button>
  </div>
</div>

</main>

<div class="panel console-wrapper">
  <h2>API Response & Assertions</h2>
  <div class="api-console" id="console">Waiting for API calls...</div>
</div>



<script>
const API = "https://fakestoreapi.com";
const cart = [];
const cache = {};
let token = null;

// Toast Notification System
function showToast(message, type = 'info', title = '') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  
  const icons = {
    success: '‚úÖ',
    error: '‚ùå',
    warning: '‚ö†Ô∏è',
    info: '‚ÑπÔ∏è'
  };
  
  const titles = {
    success: title || 'Success',
    error: title || 'Error',
    warning: title || 'Warning',
    info: title || 'Info'
  };
  
  toast.innerHTML = `
    <div class="toast-icon">${icons[type]}</div>
    <div class="toast-content">
      <div class="toast-title">${titles[type]}</div>
      <div class="toast-message">${message}</div>
    </div>
    <button class="toast-close" onclick="removeToast(this)">√ó</button>
  `;
  
  container.appendChild(toast);
  
  setTimeout(() => {
    removeToast(toast.querySelector('.toast-close'));
  }, 4000);
}

function removeToast(btn) {
  const toast = btn.parentElement;
  toast.classList.add('removing');
  setTimeout(() => toast.remove(), 300);
}

// API logging and assertions
function log({method, url, status, req, res, error, startTime}) {
  const endTime = new Date();
  const duration = startTime ? endTime - startTime : 0;

  let outcome = "";
  if (error) outcome = "‚ùå API Failed";
  else if (status >= 400) outcome = "‚ùå API Error";
  else outcome = "‚úÖ Success";

  // Compute total cart value if products exist
  let total = null;
  if (req && req.products) {
    total = req.products.reduce((sum, p) => {
      const prod = cache[p.productId];
      return sum + (prod ? prod.price * p.quantity : 0);
    }, 0);
  }

  // Enrich request with product titles for clarity
  let displayReq = req;
  if (req && req.products) {
    displayReq = {...req};
    displayReq.products = req.products.map(p => {
      const prod = cache[p.productId];
      return {
        productId: p.productId,
        title: prod ? prod.title : "Unknown",
        quantity: p.quantity,
        price: prod ? prod.price : "N/A"
      };
    });
  }

  // Assertions
  const checks = [
    {name: "Status < 400", ok: status && status < 400},
    {name: "Response not empty", ok: res != null},
    {name: "Cart total matches sum", ok: total === null || total >= 0}
  ];

  const assertionsHTML = checks.map(c =>
    `<span class="${c.ok ? 'pass' : 'fail'}">${c.ok ? '‚úì' : '‚úó'} ${c.name}</span>`
  ).join("<br/>");

  document.getElementById("console").innerHTML = `
<b>Time:</b> ${endTime.toLocaleTimeString()}<br/>
<b>Duration:</b> ${duration} ms<br/>
<b>Method:</b> ${method}<br/>
<b>Endpoint:</b> ${url}<br/>
<b>Status:</b> ${status ? status : "ERROR"}<br/>
<b>Outcome:</b> ${outcome}<br/>
${displayReq ? `<b>Request:</b><pre>${JSON.stringify(displayReq,null,2)}</pre>` : ""}
<b>Response:</b><pre>${res ? JSON.stringify(res,null,2) : error}</pre>
${total !== null ? `<b>Total Cart Value:</b> $${total.toFixed(2)}<br/>` : ""}
<b>Assertions:</b><br/>${assertionsHTML}
`;
}

// Helper to simulate failure
function failMode(url){
  return document.getElementById("failToggle").checked ? url + "_fail_test_404" : url;
}

// LOGIN
async function login() {
showToast("Successfully logged in!", "success", "Authentication");
  const url = `${API}/auth/login`;
  const body = { username: "mor_2314", password: "83r5^_" };
  const startTime = new Date();
  try {
    const r = await fetch(url, { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(body) });
    const d = await r.json();
    token = d.token;
    log({method:"POST", url, status:r.status, req:body, res:d, startTime});
  } catch(err) {
showToast("Login failed. Please try again.", "error", "Authentication");
    log({method:"POST", url, error:err, startTime});
  }
}

// LOAD ALL PRODUCTS OR FILTERED BY CATEGORY
async function loadProducts(category=null) {
  let url = category ? `${API}/products/category/${category}` : `${API}/products`;
  url = failMode(url);
  const startTime = new Date();
  try {
    const r = await fetch(url);
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();
    log({method:"GET", url, status:r.status, res:d, startTime});

    const p = document.getElementById("products"); p.innerHTML="";
    (Array.isArray(d) ? d : []).forEach(x=>{
      cache[x.id] = x;
      p.innerHTML += `
        <div class="product">
          <img src="${x.image}">
          <b>${x.title}</b><br/>
          <span class="price">$${x.price}</span><br/>
          <button onclick="add(${x.id})">‚ûï Add</button>
          <button onclick="viewDetails(${x.id})">üëÅÔ∏è Details</button>
        </div>`;
    });
  } catch(err){
    log({method:"GET", url, error:err, startTime});
  }
}

// FETCH PRODUCT DETAILS
async function viewDetails(id) {
  let url = `${API}/products/${id}`;
  url = failMode(url);
  const startTime = new Date();
  try {
    const r = await fetch(url);
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();
    log({method:"GET", url, status:r.status, res:d, startTime});
    alert(`Product Details:\nTitle: ${d.title}\nPrice: $${d.price}\nCategory: ${d.category}\nRating: ${d.rating.rate} (${d.rating.count} reviews)`);
  } catch(err){
    log({method:"GET", url, error:err, startTime});
    showToast("Failed to fetch product details", "error");
  }
}

// LOAD CATEGORIES
async function loadCategories() {
  let url = `${API}/products/categories`;
  url = failMode(url);
  const startTime = new Date();
  try {
    const r = await fetch(url);
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();
    log({method:"GET", url, status:r.status, res:d, startTime});

    const catDiv = document.getElementById("categories"); 
    catDiv.innerHTML = `<button onclick="loadProducts()">All</button>`;
    d.forEach(c => {
      catDiv.innerHTML += `<button onclick="loadProducts('${c}')">${c}</button>`;
    });
  } catch(err){
    log({method:"GET", url, error:err, startTime});
  }
}

// CART MANAGEMENT
function add(id){
  const e = cart.find(i => i.id===id);
  e ? e.qty++ : cart.push({id, qty:1});
  render();
  flashProduct(id);
}
function iQty(id,n){ const i = cart.find(x=>x.id===id); if(i && i.qty+n>0){ i.qty+=n; render(); } }
function del(id){ cart.splice(cart.findIndex(x=>x.id===id),1); render(); }
function render(){
  const c = document.getElementById("cart");
  if(!cart.length){ c.innerHTML = '<div class="empty-cart">Cart is empty</div>'; return; }
  let t=0;
  c.innerHTML = cart.map(i=>{
    const p = cache[i.id];
    const s = p.price*i.qty; t+=s;
    return `<div class="cart-item">
      <b>${p.title}</b>
      <div style="margin-top: 8px;">
        <button onclick="iQty(${i.id},-1)">‚àí</button>
        <span style="margin: 0 8px; font-weight: 600;">${i.qty}</span>
        <button onclick="iQty(${i.id},1)">+</button>
        <span style="float: right; color: #10b981; font-weight: 700;">$${s.toFixed(2)}</span>
        <button class="danger" onclick="del(${i.id})" style="float: right; margin-right: 8px;">üóëÔ∏è</button>
      </div>
    </div>`;
  }).join("") + `<hr><div style="text-align: right; font-size: 18px;"><b>Total: <span style="color: #10b981;">$${t.toFixed(2)}</span></b></div>`;
}

// SYNC CART VIA PUT
async function syncCart() {
  if (!cart.length) { showToast("Cart is empty. Add items first!", "warning", "Cart"); }

  let url = `${API}/carts/1`;
  if (document.getElementById("failToggle").checked) url += "_fail_test_404";

  const body = {
    userId: 1,
    date: new Date().toISOString(),
    products: cart.map(i => ({productId: i.id, quantity: i.qty}))
  };

  const startTime = new Date();
  try {
    const r = await fetch(url, {
      method: "PUT",
      headers: {"Content-Type": "application/json", "Authorization": token ? `Bearer ${token}` : ""},
      body: JSON.stringify(body)
    });
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();
    log({method:"PUT", url, status:r.status, req:body, res:d, startTime});
    showToast("Cart synced successfully!", "success", "Sync");
  } catch(err) {
    log({method:"PUT", url, error:err, startTime});
    showToast("Cart sync failed. Check API console.", "error", "Sync");
  }
}

// CHECKOUT
async function checkout() {
  if(!cart.length){ showToast("Cart is empty. Add items first!", "warning", "Checkout"); return; }
  let url = failMode(`${API}/carts`);
  const body = { userId:1, date:new Date().toISOString(), products:cart.map(i=>({productId:i.id, quantity:i.qty})) };
  const startTime = new Date();
  try {
    const r = await fetch(url, { method:"POST", headers:{"Content-Type":"application/json","Authorization":token?`Bearer ${token}`:""}, body: JSON.stringify(body) });
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();
    log({method:"POST", url, status:r.status, req:body, res:d, startTime});
    showToast("Checkout completed successfully! üéâ", "success", "Checkout");
  } catch(err) {
    log({method:"POST", url, error:err, startTime});
    showToast("Checkout failed. See API console.", "error", "Checkout");
  }
}

// Flash product card on Add
function flashProduct(id){
  const el = document.querySelector(`.product button[onclick="add(${id})"]`).parentElement;
  el.style.transition = "all 0.3s ease";
  el.style.backgroundColor = "rgba(167, 139, 250, 0.2)";
  el.style.borderColor = "#a78bfa";
  setTimeout(()=> {
    el.style.backgroundColor = "rgba(15, 23, 42, 0.6)";
    el.style.borderColor = "rgba(100, 116, 139, 0.3)";
  }, 400);
}
</script>
</body>
</html>