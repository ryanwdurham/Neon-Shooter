<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>⚡ Neon Aim Trainer Ultra</title>
    <style>
        /* KEEPING YOUR CORE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #000; font-family: 'Courier New', monospace; overflow: hidden; color: #0ff; touch-action: none; }
        
        #background { position: fixed; inset: 0; background: radial-gradient(ellipse at 20% 30%, rgba(138, 43, 226, 0.15), transparent 50%), radial-gradient(ellipse at 80% 70%, rgba(0, 255, 255, 0.15), transparent 50%), linear-gradient(180deg, #000814 0%, #000000 100%); z-index: -1; }
        #grid { position: fixed; inset: 0; background-image: linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px); background-size: 50px 50px; z-index: -1; }

        #game-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; cursor: crosshair; }

        /* HUD - ROCK STABLE ON MOBILE */
        #ui { position: fixed; top: 15px; left: 0; width: 100%; display: flex; justify-content: space-around; align-items: center; z-index: 100; pointer-events: none; }
        .stat { text-align: center; text-shadow: 0 0 10px currentColor; }
        .stat label { display: block; font-size: 10px; text-transform: uppercase; opacity: 0.7; letter-spacing: 1px; }
        .stat span { font-size: 24px; font-weight: bold; color: #fff; }

        /* COMBO FLASH EFFECT */
        #combo-wrap.flash { animation: comboHit 0.3s ease-out; }
        @keyframes comboHit { 0% { transform: scale(1); } 50% { transform: scale(1.3); filter: brightness(2); } 100% { transform: scale(1); } }

        /* SLEEK POWERUP BOX */
        #powerupIndicator { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); padding: 12px 24px; border-radius: 50px; background: rgba(0, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid #0ff; color: #fff; z-index: 1000; opacity: 0; transition: 0.4s; pointer-events: none; font-weight: bold; box-shadow: 0 0 20px rgba(0,255,255,0.3); }
        #powerupIndicator.active { opacity: 1; transform: translateX(-50%) translateY(-10px); }

        .screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; text-align: center; }
        .btn { padding: 18px 50px; font-size: 24px; background: transparent; border: 2px solid #0ff; color: #0ff; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 0 15px rgba(0,255,255,0.3); }
        .btn:hover { background: #0ff; color: #000; box-shadow: 0 0 30px #0ff; }
        
        h1 { font-size: 50px; margin-bottom: 10px; background: linear-gradient(45deg, #0ff, #f0f); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>

<div id="background"></div>
<div id="grid"></div>
<canvas id="game-canvas"></canvas>

<div id="ui">
    <div class="stat" style="color: #0ff;"><label>Score</label><span id="score">0</span></div>
    <div class="stat" style="color: #f0f;"><label>Time</label><span id="time">60</span></div>
    <div id="combo-wrap" class="stat" style="color: #ff0;"><label>Combo</label><span id="combo">0</span></div>
</div>

<div id="powerupIndicator">⚡ SLOW MOTION ⚡</div>

<div id="startScreen" class="screen">
    <h1>NEON AIM</h1>
    <p style="color: #888; margin-bottom: 30px;">Hit targets. Build combos. Avoid red.</p>
    <button class="btn" onclick="startGame()">START TRAINING</button>
</div>

<div id="endScreen" class="screen" style="display:none;">
    <h1 style="color: #f0f;">ROUND OVER</h1>
    <div id="finalStats" style="color: #fff; font-size: 22px; margin-bottom: 30px; line-height: 1.8;"></div>
    <button class="btn" onclick="startGame()">PLAY AGAIN</button>
</div>

<script>
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
let width, height, dpr;

// Sounds from YOUR website folders
const sounds = {
    laser: ['sounds/laser1.mp3', 'sounds/laser2.mp3', 'sounds/laser3.mp3'],
    hit: 'sounds/explosion1.mp3',
    music: 'sounds/electronic2.mp3'
};
const musicObj = new Audio(sounds.music); musicObj.loop = true;

function playSound(type) {
    const src = type === 'laser' ? sounds.laser[Math.floor(Math.random()*3)] : sounds.hit;
    const a = new Audio(src);
    a.volume = type === 'laser' ? 0.3 : 0.5;
    a.play().catch(() => {});
}

// Game State
let targets = [], markers = [];
let score = 0, combo = 0, maxCombo = 0, hits = 0, shots = 0, timeLeft = 60;
let gameActive = false, slowTime = false;
let lastTime = 0, spawnTimer = 0;

// BALANCED DIFFICULTY
const getDifficulty = () => {
    const elapsed = 60 - timeLeft;
    return {
        spawnRate: Math.max(300, 750 - (elapsed * 7)), // Smoother drop
        speedMult: 1 + (elapsed / 50),                 // Only 2x speed at end, not 3x
        maxTargets: 8 + Math.floor(elapsed / 10)       // Controlled target count
    };
};

const SHAPES = ['circle', 'square', 'triangle', 'star', 'hexagon', 'heart'];
const COLORS = ['#0ff', '#f0f', '#ff0', '#0f0', '#f80', '#f08', '#fff'];

class Target {
    constructor(type = 'normal') {
        const diff = getDifficulty();
        this.type = type;
        this.shape = SHAPES[Math.floor(Math.random() * SHAPES.length)];
        
        // Size variety from your original logic
        const roll = Math.random();
        if (roll < 0.1) { this.size = 18; this.basePoints = 120; this.speed = 3.2; }
        else if (roll < 0.4) { this.size = 30; this.basePoints = 50; this.speed = 2.2; }
        else { this.size = 50; this.basePoints = 20; this.speed = 1.2; }

        this.color = type === 'trap' ? '#f00' : (type === 'powerup' ? '#fff' : COLORS[Math.floor(Math.random() * 6)]);
        if (type === 'powerup') this.shape = 'star';

        this.x = Math.random() * (width - 100) + 50;
        this.y = Math.random() * (height - 200) + 100;
        
        const angle = Math.random() * Math.PI * 2;
        const s = this.speed * diff.speedMult;
        this.vx = Math.cos(angle) * s;
        this.vy = Math.sin(angle) * s;
        this.life = 1.0;
        this.dead = false;
    }

    update() {
        const m = slowTime ? 0.3 : 1;
        this.x += this.vx * m;
        this.y += this.vy * m;
        if (this.x < this.size || this.x > width - this.size) this.vx *= -1;
        if (this.y < 80 || this.y > height - 100) this.vy *= -1;
        this.life -= 0.003; 
        if (this.life <= 0) { this.dead = true; if(this.type === 'normal') combo = 0; }
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.globalAlpha = this.life;
        ctx.shadowBlur = 15; ctx.shadowColor = this.color;
        ctx.strokeStyle = this.color; ctx.lineWidth = 3;
        ctx.fillStyle = this.color + '22';
        
        ctx.beginPath();
        if (this.shape === 'circle') ctx.arc(0, 0, this.size, 0, Math.PI*2);
        else if (this.shape === 'square') ctx.rect(-this.size/2, -this.size/2, this.size, this.size);
        else if (this.shape === 'star') {
            for(let i=0; i<5; i++) {
                ctx.lineTo(Math.cos((18+i*72)/180*Math.PI)*this.size, -Math.sin((18+i*72)/180*Math.PI)*this.size);
                ctx.lineTo(Math.cos((54+i*72)/180*Math.PI)*(this.size/2), -Math.sin((54+i*72)/180*Math.PI)*(this.size/2));
            }
        } else if (this.shape === 'heart') {
            ctx.moveTo(0, 5); ctx.bezierCurveTo(0,-10,-20,-10,-20,10); ctx.bezierCurveTo(-20,25,0,35,0,45); ctx.bezierCurveTo(0,35,20,25,20,10); ctx.bezierCurveTo(20,-10,0,-10,0,5);
        } else {
            for(let i=0; i<3; i++) ctx.lineTo(this.size * Math.cos(i * 2 * Math.PI / 3 - Math.PI/2), this.size * Math.sin(i * 2 * Math.PI / 3 - Math.PI/2));
        }
        
        ctx.closePath(); ctx.stroke(); ctx.fill();
        ctx.restore();
    }
}

class Marker {
    constructor(x, y, txt, color) { this.x = x; this.y = y; this.txt = txt; this.color = color; this.alpha = 1; }
    update() { this.y -= 1.2; this.alpha -= 0.02; }
    draw() {
        ctx.save(); ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color;
        ctx.font = 'bold 22px Courier New'; ctx.textAlign = 'center';
        ctx.shadowBlur = 5; ctx.shadowColor = this.color;
        ctx.fillText(this.txt, this.x, this.y); ctx.restore();
    }
}

function resize() {
    dpr = window.devicePixelRatio || 1;
    width = window.innerWidth; height = window.innerHeight;
    canvas.width = width * dpr; canvas.height = height * dpr;
    canvas.style.width = width + 'px'; canvas.style.height = height + 'px';
    ctx.scale(dpr, dpr);
}
window.addEventListener('resize', resize); resize();

function startGame() {
    score = 0; combo = 0; maxCombo = 0; hits = 0; shots = 0; timeLeft = 60; targets = []; markers = [];
    gameActive = true;
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('endScreen').style.display = 'none';
    musicObj.currentTime = 0; musicObj.play().catch(() => {});
    requestAnimationFrame(gameLoop);
    
    const clock = setInterval(() => {
        if (!gameActive) { clearInterval(clock); return; }
        timeLeft--;
        document.getElementById('time').textContent = timeLeft;
        if (timeLeft <= 0) endGame();
    }, 1000);
}

function endGame() {
    gameActive = false;
    musicObj.pause();
    document.getElementById('endScreen').style.display = 'flex';
    const acc = Math.round((hits / Math.max(1, shots)) * 100);
    document.getElementById('finalStats').innerHTML = `SCORE: ${score}<br>ACCURACY: ${acc}%<br>MAX COMBO: ${maxCombo}`;
}

function gameLoop(time) {
    if (!gameActive) return;
    const dt = time - lastTime; lastTime = time;
    const diff = getDifficulty();

    ctx.clearRect(0, 0, width, height);

    spawnTimer += dt;
    if (spawnTimer > diff.spawnRate && targets.length < diff.maxTargets) {
        const r = Math.random();
        if (r < 0.07) targets.push(new Target('powerup'));
        else if (r < 0.15) targets.push(new Target('trap'));
        else targets.push(new Target('normal'));
        spawnTimer = 0;
    }

    targets = targets.filter(t => !t.dead);
    targets.forEach(t => { t.update(); t.draw(); });

    markers = markers.filter(m => m.alpha > 0);
    markers.forEach(m => { m.update(); m.draw(); });

    document.getElementById('score').textContent = score;
    document.getElementById('combo').textContent = combo;
    requestAnimationFrame(gameLoop);
}

function handleInput(x, y) {
    if (!gameActive) return;
    shots++;
    let hitFound = false;

    targets.sort((a,b) => a.size - b.size).forEach(t => {
        if (hitFound) return;
        const d = Math.hypot(t.x - x, t.y - y);
        if (d < t.size + 15) {
            hitFound = true; t.dead = true;
            playSound('hit');
            
            if (t.type === 'powerup') {
                slowTime = true;
                const ind = document.getElementById('powerupIndicator');
                ind.classList.add('active');
                setTimeout(() => { slowTime = false; ind.classList.remove('active'); }, 6000);
            } else {
                if (t.type === 'trap') {
                    combo = 0; score = Math.max(0, score - 50);
                    markers.push(new Marker(x, y, "-50", "#f00"));
                } else {
                    hits++; combo++; if(combo > maxCombo) maxCombo = combo;
                    const p = Math.round(t.basePoints * (1 + combo * 0.1));
                    score += p;
                    markers.push(new Marker(x, y, `+${p}`, t.color));
                    
                    // Flash the combo meter
                    const wrap = document.getElementById('combo-wrap');
                    wrap.classList.remove('flash'); void wrap.offsetWidth; wrap.classList.add('flash');
                }
            }
        }
    });
    if (!hitFound) { 
        combo = 0; 
        playSound('laser');
    }
}

canvas.addEventListener('mousedown', e => handleInput(e.clientX, e.clientY));
canvas.addEventListener('touchstart', e => { 
    e.preventDefault(); 
    handleInput(e.touches[0].clientX, e.touches[0].clientY); 
}, {passive:false});
</script>
</body>
</html>